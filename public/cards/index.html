<!DOCTYPE html>
<html class="h-100">
  <head>
    <title>Cards</title>
    <meta name="viewport" content="width=device-width">
    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="/css/dark.css">

    <link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css">
  </head>
  <body class="h-100">
    <div id="app" class="container py-3 h-100">
      <div class="d-flex flex-column h-100">
        <form @submit.prevent="joinRoom" class="form-row px-3 flex-shrink-0" :class="{ 'd-none d-md-flex': connected }">
          <div class="form-group col-12 col-md px-md-4">
            <div class="row align-items-center">
              <label for="room-id" class="col-4 col-md-auto mb-0">
                Room ID
              </label>
              <div class="input-group col mr-2 p-0">
                <input v-model="roomId" id="room-id" class="form-control" :readonly="connected">
                <div v-if="!roomId" class="input-group-append">
                  <button @click.prevent="randomRoomId" class="btn btn-outline-secondary">
                    Random
                  </button>
                </div>
              </div>
            </div>
          </div>
        
          <div class="form-group col-12 col-md px-md-4">
            <div class="row align-items-center">
              <label for="name" class="col-4 col-md-auto mb-0">
                Name
              </label>
              <input v-model="name" id="name" class="form-control col mr-2" :readonly="connected">
            </div>
          </div>

          <div class="form-group col-12 col-md-auto px-md-4" v-if="!connected">
            <button class="btn btn-primary" :disabled="connected || invalidJoinInfo">
              Connect
            </button>
          </div>
        </form>
        <div v-if="connected" id="messages" class="overflow-auto flex-grow-1 px-3">
          <div v-for="message in messages" class="px-md-4 pb-2">
            <div v-if="message.type === 'message'">
              <div class="mb-1">
                <span @click="setGroup(message.data.from)" :class="groupClass(message.data.from)">{{ message.data.from }}</span> to <span @click="setGroup(message.data.to)" :class="groupClass(message.data.to)">{{ message.data.to === name ? 'You' : message.data.to }}</span>
              </div>
              <div style="white-space: pre-wrap;">{{ message.data.text }}</div>
            </div>
            <div v-else-if="message.type === 'action'" class="rounded py-1 px-2 action-bg">
              <div v-if="message.data.command">
                <span class="mr-1">You</span> <code style="white-space: pre-wrap;">{{ message.data.command }}</code>
              </div>
              <div class="text-monospace mt-1" style="white-space: pre-wrap">{{ message.data.output }}</div>
              <div v-if="message.data.cardsText" class="text-monospace">
                <div v-if="message.data.cardsText === 'None'">
                  None
                </div>
                <div v-else v-for="card in message.data.cardsText">
                  <span v-if="!message.data.hideCardIndices"><code>{{ card.index }}</code>: </span>{{ card.text }}
                </div>
              </div>
            </div>
            <div v-else-if="message.type === 'info'" class="text-monospace">
              <span class="font-weight-bold">{{ message.data.name }}</span> {{ message.data.event }}
            </div>
            <div v-else-if="message.type === 'error'" class="rounded py-1 px-2 action-bg">
              <div>
                <span class="mr-1">You</span> <code style="white-space: pre-wrap;">{{ message.data.command }}</code>
              </div>
              <div class="text-monospace mt-1">
                <strong class="text-danger">Error</strong> {{ message.data.text }}
              </div>
            </div>
            <div v-else style="white-space: pre-wrap">{{ message }}</div>
          </div>
        </div>
        <form v-if="connected" @submit.prevent="sendMessage" class="flex-shrink-0 form-row px-3">
          <div class="form-group col-12 px-md-4 mb-0">
            <div class="row align-items-center">
              <div class="col">
                <div class="input-group">
                  <div class="input-group-prepend">
                    <button class="btn btn-outline-secondary" type="button" data-toggle="modal" data-target="#help-modal">
                      Help
                    </button>
                  </div>
                  <textarea 
                    v-model="message"
                    @keydown.enter="messageInputEnter"
                    @keydown.up="navigateHistory(1, $event)"
                    @keydown.down="navigateHistory(-1, $event)"
                    class="form-control" 
                    :class="{ 'text-monospace': messageIsCommand }"
                    placeholder="Message or command"
                    style="height: 2.4em; resize: none;"
                  ></textarea>
                </div>
              </div>
              <div class="col-auto">
                <div class="btn-group dropup">
                  <button class="btn btn-primary d-inline-flex align-items-center" :disabled="message.trim().length === 0">
                    <i class="ri-chat-upload-fill mr-2"></i>
                    <div class="text-truncate" style="max-width: 100px;">
                      {{ messageIsCommand ? 'Execute' : sendTo }}
                    </div>
                  </button>
                  <button type="button" :disabled="messageIsCommand || peersPlusGroups.length === 1" class="btn btn-primary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown"></button>
                  <div class="dropdown-menu dropdown-menu-right overflow-auto mh-screen">
                    <!-- <button @click.prevent="manageGroups" class="dropdown-item d-inline-flex align-items-center">
                      <i class="ri-group-fill mr-1"></i> Manage groups...
                    </button> -->
                    <button v-for="option in peersPlusGroups" @click.prevent="sendTo = option" class="dropdown-item" :class="{ 'active': option === sendTo }" type="button">
                      {{ option }}
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </form>

        <div class="modal" id="help-modal">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Help</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <div class="accordion" id="accordion">
                  <div class="card">
                    <div class="card-header p-1">
                      <h5 class="mb-0">
                        <button class="btn btn-a" data-toggle="collapse" data-target="#collapse-basics">
                          Basics
                        </button>
                      </h5>
                    </div>
                    <div class="collapse show" id="collapse-basics" data-parent="#accordion">
                      <div class="card-body">
                        <h6>
                          Commands
                        </h6>
                        <p>
                          To execute a command, start your message with a&nbsp;<code>.</code>(period)
                          <br>
                          Like <code>.command option1 option2...</code>
                        </p>

                        <h6>
                          Types
                        </h6>
                        <p>
                          <code class="font-weight-bold">pile</code>
                          <br>
                          There are three main piles: <code>draw</code>, <code>discard</code>, and <code>hand</code>
                          <br>
                          <code>draw</code> and <code>discard</code> are shared among all players
                          <br>
                          <code>hand</code> is personal and hidden from all other players
                          <br>
                          Another players hand can also be referenced by the player's name
                        </p>
                        <p>
                          <code class="font-weight-bold">cards</code>
                          <br>
                          Cards are referenced by their index. Whenever a set of cards are shown they will be formatted like
                          <br>
                          <span class="text-monospace">1: Ace of Spades</span>
                          <br>
                          The ace of spades would then be referenced by <code>1</code>
                          <br>
                          There are also some shortcuts to reference groups of cards like
                          <code>all</code> <code>top 5</code>, <code>bottom 5</code>, or <code>random 5</code>
                        </p>
                        <p>
                          <code class="font-weight-bold">players</code>
                          <br>
                          Players are referenced by their name and are case insensetive. "everyone" is a shortcut for all players
                        </p>
                        <p>
                          <code class="font-weight-bold">amount</code>
                          <br>
                          An amount is any number greater than 0 or <code>all</code>
                        </p>
                        <p>
                          <code class="font-weight-bold">position</code>
                          <br>
                          A position can be "top" "bottom" or "random"
                        </p>

                        <h6>
                          Command Formats
                        </h6>
                        <div>
                          <code>=</code> The option is not required and has a default value
                          <br>
                          <code>""</code> Represents a required word
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="card">
                    <div class="card-header p-1">
                      <h5 class="mb-0">
                        <button class="btn btn-a text-monospace" data-toggle="collapse" data-target="#collapse-start">
                          start
                        </button>
                      </h5>
                    </div>
                    <div class="collapse" id="collapse-start" data-parent="#accordion">
                      <div class="card-body">
                        <p>
                          Starts a new game
                          <br>
                          <strong>Note:</strong> Once the game is started, new players will be unable to join
                        </p>

                        <h6>
                          Format
                        </h6>
                        <p>
                          <code>.start preset=standard</code>
                        </p>

                        <h6>
                          Example
                        </h6>
                        <p>
                          <code>.start uno</code>
                        </p>

                        <h6>Presets</h6>
                        <p>
                          <code class="font-weight-bold">standard</code>
                          <br>
                          Standard 54 card deck
                          <br>
                          Sort by <code>value</code> or <code>suit</code>
                        </p>
                        <p>
                          <code class="font-weight-bold">scum</code> or <code class="font-weight-bold">president</code>
                          <br>
                          Standard 52 card deck (no jokers)
                          <br>
                          Sort by <code>value</code> or <code>suit</code>
                          <br>
                          Deals out all of the cards
                        </p>
                        <p>
                          <code class="font-weight-bold">uno</code>
                          <br>
                          Standard 108 card Uno deck
                          <br>
                          Sort by <code>color</code> or <code>number</code>
                          <br>
                          Deals 7 cards to each player and places a card on the discard pile
                        </p>
                        <p>
                          <code class="font-weight-bold">mafia</code>
                          <br>
                          Mafia, Detective, and Doctor cards
                        </p>
                      </div>
                    </div>
                  </div>

                  <div class="card">
                    <div class="card-header p-1">
                      <h5 class="mb-0">
                        <button class="btn btn-a text-monospace" data-toggle="collapse" data-target="#collapse-add">
                          add
                        </button>
                      </h5>
                    </div>
                    <div class="collapse" id="collapse-add" data-parent="#accordion">
                      <div class="card-body">
                        <p>
                          Adds a full set of cards to the specified pile
                        </p>

                        <h6>
                          Format
                        </h6>
                        <p>
                          <code>.add pile=draw</code>
                        </p>

                        <h6>
                          Example
                        </h6>
                        <code>.add discard</code>
                      </div>
                    </div>
                  </div>

                  <div class="card">
                    <div class="card-header p-1">
                      <h5 class="mb-0">
                        <button class="btn btn-a text-monospace" data-toggle="collapse" data-target="#collapse-choose">
                          choose
                        </button>
                      </h5>
                    </div>
                    <div class="collapse" id="collapse-choose" data-parent="#accordion">
                      <div class="card-body">
                        <p>
                          Takes the specified cards from the pile and adds them to your hand
                        </p>

                        <h6>
                          Format
                        </h6>
                        <p>
                          <code>.choose cards "from" pile=draw</code>
                        </p>

                        <h6>
                          Example
                        </h6>
                        <code>.choose 3 8 4 from discard</code>
                      </div>
                    </div>
                  </div>

                  <div class="card">
                    <div class="card-header p-1">
                      <h5 class="mb-0">
                        <button class="btn btn-a text-monospace" data-toggle="collapse" data-target="#collapse-count">
                          count
                        </button>
                      </h5>
                    </div>
                    <div class="collapse" id="collapse-count" data-parent="#accordion">
                      <div class="card-body">
                        <p>
                          Tells you the amount of cards in a specified pile
                        </p>

                        <h6>
                          Format
                        </h6>
                        <p>
                          <code>.count pile=hand</code>
                        </p>

                        <h6>
                          Example
                        </h6>
                        <code>.count draw</code>
                      </div>
                    </div>
                  </div>

                  <div class="card">
                    <div class="card-header p-1">
                      <h5 class="mb-0">
                        <button class="btn btn-a text-monospace" data-toggle="collapse" data-target="#collapse-deal">
                          deal
                        </button>
                      </h5>
                    </div>
                    <div class="collapse" id="collapse-deal" data-parent="#accordion">
                      <div class="card-body">
                        <p>
                          Deals out to the specified players from the top of a pile
                        </p>

                        <h6>
                          Format
                        </h6>
                        <p>
                          <code>.deal amount=all "from" pile=draw "to" players=everyone</code>
                        </p>

                        <h6>
                          Example
                        </h6>
                        <code>.deal 4 from hand to jim sally</code>
                      </div>
                    </div>
                  </div>

                  <div class="card">
                    <div class="card-header p-1">
                      <h5 class="mb-0">
                        <button class="btn btn-a text-monospace" data-toggle="collapse" data-target="#collapse-look">
                          look
                        </button>
                      </h5>
                    </div>
                    <div class="collapse" id="collapse-look" data-parent="#accordion">
                      <div class="card-body">
                        <p>
                          Shows you the specified cards from a deck
                        </p>

                        <h6>
                          Format
                        </h6>
                        <p>
                          <code>.look cards=all "in" pile=hand</code>
                        </p>

                        <h6>
                          Example
                        </h6>
                        <code>.look top 3 in draw</code>
                      </div>
                    </div>
                  </div>

                  <div class="card">
                    <div class="card-header p-1">
                      <h5 class="mb-0">
                        <button class="btn btn-a text-monospace" data-toggle="collapse" data-target="#collapse-make">
                          make
                        </button>
                      </h5>
                    </div>
                    <div class="collapse" id="collapse-make" data-parent="#accordion">
                      <div class="card-body">
                        <p>
                          Creates a new pile
                        </p>

                        <h6>
                          Format
                        </h6>
                        <p>
                          <code>.make pilename</code>
                        </p>

                        <h6>
                          Example
                        </h6>
                        <code>.make finished</code>
                      </div>
                    </div>
                  </div>

                  <div class="card">
                    <div class="card-header p-1">
                      <h5 class="mb-0">
                        <button class="btn btn-a text-monospace" data-toggle="collapse" data-target="#collapse-move">
                          move
                        </button>
                      </h5>
                    </div>
                    <div class="collapse" id="collapse-move" data-parent="#accordion">
                      <div class="card-body">
                        <p>
                          Moves specified cards between decks
                        </p>

                        <h6>
                          Format
                        </h6>
                        <p>
                          <code>.move cards=top "from" pile=draw "to" position=top pile=discard</code>
                        </p>

                        <h6>
                          Example
                        </h6>
                        <code>.move bottom 3 from discard to bottom draw</code>
                      </div>
                    </div>
                  </div>

                  <div class="card">
                    <div class="card-header p-1">
                      <h5 class="mb-0">
                        <button class="btn btn-a text-monospace" data-toggle="collapse" data-target="#collapse-play">
                          play
                        </button>
                      </h5>
                    </div>
                    <div class="collapse" id="collapse-play" data-parent="#accordion">
                      <div class="card-body">
                        <p>
                          Places specified cards from your hand onto a pile and shows them to all players
                        </p>

                        <h6>
                          Format
                        </h6>
                        <p>
                          <code>.play cards "onto" position=top pile=discard</code>
                        </p>

                        <h6>
                          Example
                        </h6>
                        <code>.play 3 6 8 onto bottom draw</code>
                      </div>
                    </div>
                  </div>

                  <div class="card">
                    <div class="card-header p-1">
                      <h5 class="mb-0">
                        <button class="btn btn-a text-monospace" data-toggle="collapse" data-target="#collapse-put">
                          put
                        </button>
                      </h5>
                    </div>
                    <div class="collapse" id="collapse-put" data-parent="#accordion">
                      <div class="card-body">
                        <p>
                          Places specified cards from your hand onto a pile without showing them to other players
                        </p>

                        <h6>
                          Format
                        </h6>
                        <p>
                          <code>.put cards "onto" position=top pile=discard</code>
                        </p>

                        <h6>
                          Example
                        </h6>
                        <code>.put 7 4 3 onto random discard</code>
                      </div>
                    </div>
                  </div>

                  <div class="card">
                    <div class="card-header p-1">
                      <h5 class="mb-0">
                        <button class="btn btn-a text-monospace" data-toggle="collapse" data-target="#collapse-remove">
                          remove
                        </button>
                      </h5>
                    </div>
                    <div class="collapse" id="collapse-remove" data-parent="#accordion">
                      <div class="card-body">
                        <p>
                          Removes the specified cards from a pile
                        </p>

                        <h6>
                          Format
                        </h6>
                        <p>
                          <code>.remove cards=all "from" pile</code>
                        </p>

                        <h6>
                          Example
                        </h6>
                        <code>.remove bottom 2 from draw</code>
                      </div>
                    </div>
                  </div>

                  <div class="card">
                    <div class="card-header p-1">
                      <h5 class="mb-0">
                        <button class="btn btn-a text-monospace" data-toggle="collapse" data-target="#collapse-roll">
                          roll
                        </button>
                      </h5>
                    </div>
                    <div class="collapse" id="collapse-roll" data-parent="#accordion">
                      <div class="card-body">
                        <p>
                          Rolls the die or set of dice specified
                        </p>

                        <h6>
                          Format
                        </h6>
                        <p>
                          <code>.roll dice=d6</code>
                        </p>

                        <h6>
                          Example
                        </h6>
                        <code>.roll 3d10</code>
                      </div>
                    </div>
                  </div>

                  <div class="card">
                    <div class="card-header p-1">
                      <h5 class="mb-0">
                        <button class="btn btn-a text-monospace" data-toggle="collapse" data-target="#collapse-show">
                          show
                        </button>
                      </h5>
                    </div>
                    <div class="collapse" id="collapse-show" data-parent="#accordion">
                      <div class="card-body">
                        <p>
                          Shows the specified cards from your hand to other players
                        </p>

                        <h6>
                          Format
                        </h6>
                        <p>
                          <code>.show cards "to" players=everyone</code>
                        </p>

                        <h6>
                          Example
                        </h6>
                        <code>.show bottom to james</code>
                      </div>
                    </div>
                  </div>

                  <div class="card">
                    <div class="card-header p-1">
                      <h5 class="mb-0">
                        <button class="btn btn-a text-monospace" data-toggle="collapse" data-target="#collapse-shuffle">
                          shuffle
                        </button>
                      </h5>
                    </div>
                    <div class="collapse" id="collapse-shuffle" data-parent="#accordion">
                      <div class="card-body">
                        <p>
                          Shuffles the specified pile
                        </p>

                        <h6>
                          Format
                        </h6>
                        <p>
                          <code>.shuffle pile=draw</code>
                        </p>

                        <h6>
                          Example
                        </h6>
                        <code>.shuffle hand</code>
                      </div>
                    </div>
                  </div>

                  <div class="card">
                    <div class="card-header p-1">
                      <h5 class="mb-0">
                        <button class="btn btn-a text-monospace" data-toggle="collapse" data-target="#collapse-sort">
                          sort
                        </button>
                      </h5>
                    </div>
                    <div class="collapse" id="collapse-sort" data-parent="#accordion">
                      <div class="card-body">
                        <p>
                          Sorts the specified pile based on a certain value
                        </p>

                        <h6>
                          Format
                        </h6>
                        <p>
                          <code>.sort pile=hand "by" sortby=value</code>
                          <br>
                          <strong>Note:</strong> The <code>sortby</code> option changes based on the type of deck you are using
                        </p>

                        <h6>
                          Example
                        </h6>
                        <code>.sort discard by suit</code>
                      </div>
                    </div>
                  </div>

                  <div class="card">
                    <div class="card-header p-1">
                      <h5 class="mb-0">
                        <button class="btn btn-a text-monospace" data-toggle="collapse" data-target="#collapse-take">
                          take
                        </button>
                      </h5>
                    </div>
                    <div class="collapse" id="collapse-take" data-parent="#accordion">
                      <div class="card-body">
                        <p>
                          Takes the specified amount of cards from the top or bottom if a pile
                        </p>

                        <h6>
                          Format
                        </h6>
                        <p>
                          <code>.take amount=1 "from" position=top pile=draw</code>
                        </p>

                        <h6>
                          Example
                        </h6>
                        <code>.take 2 from top discard</code>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.bundle.min.js" integrity="sha384-1CmrxMRARb6aLqgBO7yyAxTOQE2AKb9GfXnEo760AUcUmFx3ibVJJAzGytlQcNXd" crossorigin="anonymous"></script>

    <script src="utils.js"></script>
    <script src="cards.js"></script>
    <script src="app.js"></script>
  </body>
</html>